<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <title>CRUD - app</title>
</head>

<body>

    <div class="container my-3">

        <div class="input-group mb-3">
            <span class="input-group-text" id="basic-addon1"><svg xmlns="http://www.w3.org/2000/svg" width="16"
                    height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                    <path
                        d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z" />
                </svg></span>
            <input type="text" class="form-control" placeholder="Search Here" aria-label="Username"
                aria-describedby="basic-addon1" id="search_here">
        </div>

        <h1 class="text-center alert-danger">Enter Student data</h1>

        <div class="success-data"></div>

        <form id="myform">
            <div class="mb-3">
                <label for="first-name" class="form-label">First Name</label>
                <input type="text" class="form-control" id="first-name" required>
                <div id="fname-alert" class="form-text" style="color: red;"></div>
            </div>
            <div class="mb-3">
                <label for="last-name" class="form-label">Last Name</label>
                <input type="text" class="form-control" id="last-name" required>
                <div id="lname-alert" class="form-text" style="color: red;"></div>
            </div>
            <div class="mb-3">
                <label for="gender" class="form-label">Select Gender</label>
                <select class="form-select" aria-label="Default select example" id="gender">
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                </select>
            </div>

            <button type="submit" class="btn btn-primary" id="submit-data">Save</button>
        </form>
    </div>

    <div class="container text-center my-5" id="student-data">


    </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>

</body>


<script src="https://code.jquery.com/jquery-3.6.4.js" integrity="sha256-a9jBBRygX1Bh5lt8GZjXDzyOB+bWve9EiO7tROUtj/E="
    crossorigin="anonymous"></script>


<script>

    $(document).ready(function () {

        function loadData() {
            $.ajax({
                url: "table",
                type: "POST",
                beforeSend: function () {
                    $("#student-data").html("<h1>Loading data ...</h1>");
                },
                success: function (data) {
                    $("#student-data").html(data);
                }
            });

        }

        loadData();

        $("#search_here").keyup(function(){
            let ser = $(this).val();
            $.ajax({
                url:"Search",
                type:"POST",
                data:{search:ser},
                success:function(data){
                    $("#student-data").html(data);
                }
            });

        });


        $(document).on("click", ".update-btn", function () {
            let id2 = $(this).data("id");
            let element = this;

            let first_name = prompt("Enter First Name : ");
            let last_name = prompt("Enter last Name : ");

            // console.log(first_name,last_name);

            $.ajax({
                url: "Update",
                type: "POST",
                data: { id: id2, fname: first_name, lname: last_name },
                beforeSend:function(){
                       $(".success-data").html(`<div class="alert alert-warning alert-dismissible fade show" role="alert">
                        <strong>Update SL = ${id2} </strong> ...
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>`);
                },
                success: function(){
                    loadData();
                }
            });

            alert(id + " " + first_name + " " + last_name);
        });

        $(document).on("click", ".delete-btn", function () {
            let id = $(this).data("id");
            let element = this;

            $.ajax({
                url: "delete",
                type: "POST",
                data: { sl: id },
                beforeSend: function () {
                    $(".success-data").html(`<div class="alert alert-warning alert-dismissible fade show" role="alert">
                        <strong>Delete SL = ${id} </strong> ...
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>`);
                },
                success: function () {
                    //$(element).closest("tr").fadeOut();
                    loadData();
                }
            });

            // alert(id);
        });

        $("#myform").submit(function (e) {
            e.preventDefault();
            let fn = $("#first-name").val();
            let ln = $("#last-name").val();
            let gen = $("#gender").val();



            $.ajax({
                url: "Insert",
                type: "POST",
                data: { first_name: fn, last_name: ln, gender: gen },
                beforeSend: function () {
                    $(".success-data").html(`<div class="alert alert-warning alert-dismissible fade show" role="alert">
                        <strong>${fn + " " + ln}</strong> Please wait ...
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>`);

                },
                success: function (data) {
                    $(".success-data").html(`<div class="alert alert-success alert-dismissible fade show" role="alert">
                    <strong>${fn + " " + ln}</strong>  your data inserted.
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>`);

                    loadData();

                    $("form").trigger("reset");
                }
            });


        });




    });


</script>

</html>